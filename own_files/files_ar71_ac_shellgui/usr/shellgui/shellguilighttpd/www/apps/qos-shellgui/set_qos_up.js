!function(){function a(t){$("#cl_roles_container").empty();for(var e=0;e<t.length;e++){var s=[];for(var r in t[e])if("Set_Service_Class_To"!=r&&"order"!=r){var l=r.replace(/_/g," ");s.push("<p>"+l+":"+t[e][r]+"</p>")}var o=s.join(""),d=getClassName(t[e].Set_Service_Class_To,classes),n='<tr class="text-left" id="rule_num_'+t[e].order+'"><td>'+o+"</td><td>"+d+'</td><td><button class="btn btn-info btn-xs edit_rule_btn" data-data=\''+JSON.stringify(t[e])+'\' data-toggle="modal" data-target="#ruleModal">'+UI.Edit+'</button></td><td><button class="btn btn-danger btn-xs remove_rule_btn" data-order="order_'+t[e].order+'">'+UI.Remove+'</button></td><td><button class="btn btn-info btn-xs move_up_btn" data-order="order_'+t[e].order+'"><span class="glyphicon glyphicon-arrow-up"></span></button></td><td><button class="btn btn-info btn-xs move_down_btn" data-order="order_'+t[e].order+'"><span class="glyphicon glyphicon-arrow-down"></span></button></td></tr>';$("#cl_roles_container").append(n)}$(".edit_rule_btn").click(function(){$("#ruleModal").find(".modal-title").html(UI.Edit_QoS_Classification_Rule),$("#rule_form").prop("name","editRuleForm"),resetForm("rule_form");var a=$(this).attr("data-data"),a=JSON.parse(a);for(var t in a){var e=$("#rule_form").find('[name="'+t+'"]');e.prop("disabled",!1),"order"!=t&&e.parent().parent().parent().find('[type="checkbox"]').prop("checked",!0),"text"==e.prop("type")||"hidden"==e.prop("type")?e.val(a[t]):(e.find("option").prop("selected",!1),e.find('[value="'+a[t]+'"]').prop("selected",!0))}}),$(".remove_rule_btn").click(function(){var t=$(this).attr("data-order").replace("order_","");rule_data=removeRule(t,rule_data),a(rule_data)}),$(".move_up_btn").click(function(){var t=parseInt($(this).attr("data-order").replace("order_",""));rule_data=moveRuleUp(t,rule_data),a(rule_data)}),$(".move_down_btn").click(function(){var t=parseInt($(this).attr("data-order").replace("order_",""));rule_data=moveRuleDown(t,rule_data),a(rule_data)})}function t(a){$("#service_class_container").empty();for(var e=0;e<a.length;e++){var s,r;s=a[e].min_bw?a[e].min_bw:"zero",r=a[e].max_bw?a[e].max_bw:"nolimit";var l='<tr class="text-left"><td>'+a[e].name+"</td><td>"+a[e].percent+"%</td><td>"+s+"</td><td>"+r+'</td><td class="load_container" data-class="'+a[e]["class"]+'"></td><td><button class="btn btn-info btn-xs edit_class_btn" data-data=\''+JSON.stringify(a[e])+'\' data-toggle="modal" data-target="#classModal">'+UI.Edit+'</button></td><td><button class="btn btn-danger btn-xs remove_class_btn" data-name="'+a[e].name+'">'+UI.Remove+"</button></td></tr>";$("#service_class_container").append(l)}$(".load_container").each(function(a){for(var t=$(this).attr("data-class"),e=0;e<load.bps.length;e++)t-1==e&&$(this).html(bpsToKbpsString(load.bps[t-1]))}),$(".edit_class_btn").click(function(){$("#classModal").find(".modal-title").html(UI.Edit_QoS_Service_Class),$("#class_form").attr("data-name","EditClassForm"),resetForm("class_form");var a=$(this).attr("data-data"),a=JSON.parse(a);for(var t in a){var e=$("#class_form").find('[name="'+t+'"]');a[t]&&(e.val(a[t]),e.prop("disabled",!1),e.parent().parent().parent().find(".has_field").prop("checked",!0))}}),$(".remove_class_btn").click(function(){var a=$(this).attr("data-name");service_class_data=removeSerClass(a,service_class_data),t(service_class_data)})}function e(){var a=$("#class_form").serializeArray(),e=formatData(a);return a.max_bw||(a.max_bw=!1),a.min_bw||(a.min_bw=!1),service_class_data.push(e),t(service_class_data),!1}function s(){var a=$("#class_form").serializeArray();a=formatData(a),a.max_bw||(a.max_bw=!1),a.min_bw||(a.min_bw=!1);for(var e=0;e<service_class_data.length;e++)if(service_class_data[e].name===a.name){var s=service_class_data[e]["class"];service_class_data[e]=a,service_class_data[e]["class"]=s}return t(service_class_data),!1}function r(){$.post("/","app=qos-shellgui&action=get_qos_upload",function(e){origin_data=e.rule_data,rule_data=mapRuleData(origin_data),service_class_data=e.class_data,load=initLoadPbs(service_class_data),classes=getClassId(service_class_data),default_class=e.upload_default_class,total_bw=e.upload_total_bandwidth,a(rule_data),makeDefaultClass(classes,"up"),t(service_class_data),0==total_bw&&($("#page_switch").prop("checked",!1),$("input,button,select").prop("disabled",!0),$("#page_switch").prop("disabled",!1),clearInterval(updateLoadInterval)),$("#default_class").find("option").each(function(){$(this).val()==default_class?$(this).prop("selected",!0):$(this).prop("selected",!1)}),$("#total_bw").val(total_bw)},"json")}r(),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3),$("#page_submit").click(function(){Ha.mask.show();var a={app:"qos-shellgui",action:"set_upload",rule_data:unmapRuleData(rule_data),class_data:service_class_data,upload_total_bandwidth:$("#total_bw").val(),upload_default_class:$("#default_class").val()};clearInterval(updateLoadInterval),$.post("/",a,function(a){Ha.mask.hide(),Ha.showNotify(a),r(),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3)},"json")}),$("#page_switch").click(function(){var e=$(this).prop("checked");e?($("input,button,select").prop("disabled",!1),total_bw=320,$("#total_bw").val(total_bw),$.post("/","app=qos-shellgui&action=total_bandwidth&up_down=upload&total_bw=320",Ha.showNotify,"json"),a(rule_data),makeDefaultClass(classes,"up"),t(service_class_data),updateLoadInterval=setInterval(function(){updateLoadData("up")},1e3)):($("input,button,select").prop("disabled",!0),total_bw=0,$("#total_bw").val(total_bw),$.post("/","app=qos-shellgui&action=total_bandwidth&up_down=upload&total_bw=0",Ha.showNotify,"json"),clearInterval(updateLoadInterval)),$("#page_switch").prop("disabled",!1)}),$("#page_reset").click(function(){r()}),$(".has_switch").click(function(){var a=$(this).parent().find(".has_field").prop("checked");$(this).parent().find(".has_field").prop("checked",!a);var t=$(this).prop("for");$("#"+t).prop("disabled",a)}),$(".has_field").change(function(){var a=$(this).prop("checked"),t=$(this).parent().find(".has_switch").prop("for");$("#"+t).prop("disabled",!a).focus()}),$("#add_rule_btn").click(function(){$("#ruleModal").find(".modal-title").html(UI.Add_New_Classification_Rule),$("#rule_form").prop("name","addRuleForm"),resetForm("rule_form")}),$("#submit_rule_btn").click(function(){"addRuleForm"==$("#rule_form").prop("name")?addRule():editRule()}),$("#add_class_btn").click(function(){$("#classModal").find(".modal-title").html(UI.Add_New_Service_Class),$("#class_form").attr("data-name","addClassForm"),resetForm("class_form"),$("#class_form").find('[name="name"],[name="percent"]').prop("disabled",!1)}),$("#submit_class_btn").click(function(){"addClassForm"==$("#class_form").attr("data-name")?e():s()})}();