/*
 * FM24CL64: 64Kb Serial 3V FRAM Memory, 8KB
 * EMA SBC3730-B1-3990-LUAC0 kit, Angstrom
 * I2C Address: 0x50
 * */
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <linux/i2c.h>
#include <string.h>
#include <linux/i2c-dev.h>
#include <unistd.h>

//#define I2C_ADD 0xE6
#define I2C_ADD 0x73

main()
{
    unsigned char init_data1[3] ={ 0x00,   0xa5,   0x00 };
    unsigned char init_data2[3] ={ 0x00,   0xa4,   0x11 };

    unsigned char init_data[189] =
    {
        0x00,   0xa5,   0x00,
        0x00,   0xa4,   0x11,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x20,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x7f,   0xff,   0xff,
        0x7f,   0xff,   0xff,
        0x7f,   0xff,   0xff,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x00,   0x00,   0x00,
        0x7f,   0xff,   0xff,
        0x00,   0x00,   0x00,
        0x7f,   0xff,   0xff,
        0x00,   0xc8,   0x00,
        0x00,   0xc3,   0x01,
        0x00,   0xc6,   0x01,
        0x00,   0xc2,   0x00,
        0x00,   0xc1,   0x00,
        0x3f,   0xc4,   0xd5,
        0x00,   0xc9,   0x78,
        0x00,   0xac,   0x00,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x00,
        0xff,   0xad,   0x84,
        0x00,   0x00,   0x17,
        0xff,   0xad,   0x80,
        0x00,   0x54,   0x54,
        0xff,   0xad,   0x87,
        0x00,   0x54,   0x54,
        0xff,   0xad,   0x81,
        0x00,   0x12,   0x12,
        0xff,   0xad,   0x82,
        0x00,   0x14,   0x14,
        0xff,   0xad,   0x83,
        0x00,   0x00,   0x00,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x01,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x00,
        0xff,   0xad,   0x85,
        0x00,   0x00,   0x00,
        0xff,   0xad,   0x85,
        0x00,   0x01,   0x01,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x01,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x00,
        0xff,   0xad,   0x85,
        0x00,   0x1f,   0xff,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x01,
        0xff,   0xad,   0x86,
        0x00,   0x00,   0x00,
        0x00,   0xD2,   0x75,
        0x00,   0xD0,   0x7F,
        0x00,   0xD1,   0x50,
        0x00,   0xD2,   0x50,
    };
    
    int fd;
    fd = open("/dev/i2c-0", O_RDWR);
    if (fd < 0) {
                printf("open i2c bus fail!\n");
		//return -1;
                }
    else{
    printf("fd = %d\n", fd);
     }

    int ret;
    ret = ioctl(fd, I2C_SLAVE, I2C_ADD);  //set the I2C slave device address
  while (ret < 0) {
    printf("ioctl set i2c slave fail, set again!\n");
    usleep(500000);
    ioctl(fd, I2C_SLAVE, I2C_ADD);
    //ret = 1;
                 }
    printf("ioctl ret = %d\n", ret);

   int k;
   for(k=0;k<30;k++){
 ret = write(fd, (init_data+3*k), 3); 
   if (ret > 0){
    printf("write %d bytes OK,init_data1 command send OK!\n", ret);
   }
   else{
   printf("init_data1 command send fail!\n");
}
    usleep(500);
}
    close(fd);
}

